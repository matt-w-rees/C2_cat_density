---
subtitle: 'Supporting Information'
title: 'Quantifying mesopredator release: lethal control of an invasive apex predator changes feral cat density and detectability'
date: "`r Sys.Date()`"
author: MW Rees, JH Pascoe, M Le Pla, A Robley, EK Birnbaum, BA Wintle & BA Hradsky
bibliography: mybibfile.bib
csl: jae.csl
header-includes:
   # - \usepackage{setspace}\doublespacing
    - \usepackage{float}
    - \floatplacement{figure}{H}
geometry: margin=1.0in
fontsize: 10pt
output:
  bookdown::pdf_document2:
    toc: yes
    number_sections: yes
editor_options:
  chunk_output_type: console
---


```{r setup, include = FALSE}

knitr::opts_chunk$set(echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE)

library(bookdown)
library(tidyverse)
library(secr)            
library(mgcv)            
library(camtrapR)        
library(RColorBrewer)    
library(pander)          
library(ggplot2)         
library(gratia)
library(patchwork)
library(viridis)         
library(sf) 
library(sp) 
library(terra)

rm(list = ls())
options(scipen = 999) # get rid of scientific notation

#Set the default theme for ggplot objects to theme_bw()
theme_set(theme_bw())
theme_update(panel.grid = element_blank())

# Customise ggplot theme -----------------------------------------------------
theme_matty <- function () { 
  theme_bw(base_size=14) %+replace% 
    theme(
           # background / panels
           panel.background = element_blank(),
           panel.grid.major = element_blank(),
           panel.grid.minor = element_blank(),
           panel.border = element_rect(colour = "lightgrey", fill=NA, size=1),
           # font sizes
           axis.text = element_text(size = 14),
           axis.title = element_text(size = 14),
           title = element_text(size = 12),
           # margins
           axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
           axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0)),
           # legend
           legend.title = element_blank(),
           legend.text = element_text(size = 12),
           legend.position = "bottom"
  )
}

```


```{r, load data, include = FALSE}

# load camera-trap station info
records <- read.csv("../raw_data/spp_records_pa.csv")
records_otways <- records[which(records$region == "otways"),] 
records_glenelg <- records[which(records$region == "glenelg"),]

# lower glenelg fox records
records_lg <- read.csv("../raw_data/lower_glenelg_fox_pa.csv")

# load masks as dataframes (for covariates)
otways_mask_df <- readRDS("../derived_data/otway_mask_df.RData")
glenelg_mask_df <- readRDS("../derived_data/glenelg_mask_df.RData")

# load SECR capture histories - each session (but seperate unID from unmarked)
# mt clay (no black cats)
ch_mc <- readRDS("../derived_data/capthists/ch_mc.RData")
unid_mc <- as.matrix(read.csv("../derived_data/capthists/unid_mc.csv")[, -1]) 
mrch_mc <- addSightings(ch_mc, uncertain = unid_mc)
# hotspur 
ch_h <- readRDS("../derived_data/capthists/ch_h.RData")
unid_h <- as.matrix(read.csv("../derived_data/capthists/unid_h.csv")[, -1]) 
unm_h <- as.matrix(read.csv("../derived_data/capthists/unm_h.csv")[, -1]) 
mrch_h <- addSightings(ch_h, unmarked = unm_h, uncertain = unid_h)
# annya 
ch_a <- readRDS("../derived_data/capthists/ch_a.RData")
unid_a <- as.matrix(read.csv("../derived_data/capthists/unid_a.csv")[, -1]) 
unm_a <- as.matrix(read.csv("../derived_data/capthists/unm_a.csv")[, -1]) 
mrch_a <- addSightings(ch_a, unmarked = unm_a, uncertain = unid_a)
# cobbob 
ch_c <- readRDS("../derived_data/capthists/ch_c.RData")
unid_c <- as.matrix(read.csv("../derived_data/capthists/unid_c.csv")[, -1]) 
unm_c <- as.matrix(read.csv("../derived_data/capthists/unm_c.csv")[, -1]) 
mrch_c <- addSightings(ch_c, unmarked = unm_c, uncertain = unid_c)
# LGNP north
ch_lgnpn <- read.capthist(captfile = "../raw_data/LGNPN_caphist.txt", trapfile = "../raw_data/LGNPN_traps.txt", detector = "proximity")
# LGNP south
ch_lgnps <- read.capthist(captfile = "../raw_data/LGNPS_caphist.txt", trapfile = "../raw_data/LGNPS_traps.txt", detector = "proximity")
# northern grid 2017 
ch_n_17 <- readRDS("../derived_data/capthists/ch_n_17.RData")
unid_n_17 <- as.matrix(read.csv("../derived_data/capthists/unid_n_17.csv")[, -1]) 
unm_n_17 <- as.matrix(read.csv("../derived_data/capthists/unm_n_17.csv")[, -1]) 
mrch_n_17 <- addSightings(ch_n_17, unmarked = unm_n_17, uncertain = unid_n_17)
# northern grid 2018 
ch_n_18 <- readRDS("../derived_data/capthists/ch_n_18.RData")
unid_n_18 <- as.matrix(read.csv("../derived_data/capthists/unid_n_18.csv")[, -1]) 
unm_n_18 <- as.matrix(read.csv("../derived_data/capthists/unm_n_18.csv")[, -1]) 
mrch_n_18 <- addSightings(ch_n_18, unmarked = unm_n_18, uncertain = unid_n_18)
# northern grid 2019 
ch_n_19 <- readRDS("../derived_data/capthists/ch_n_19.RData")
unid_n_19 <- as.matrix(read.csv("../derived_data/capthists/unid_n_19.csv")[, -1]) 
unm_n_19 <- as.matrix(read.csv("../derived_data/capthists/unm_n_19.csv")[, -1]) 
mrch_n_19 <- addSightings(ch_n_19, unmarked = unm_n_19, uncertain = unid_n_19)
# southern grid 2017 
ch_s_17 <- readRDS("../derived_data/capthists/ch_s_17.RData")
unid_s_17 <- as.matrix(read.csv("../derived_data/capthists/unid_s_17.csv")[, -1]) 
unm_s_17 <- as.matrix(read.csv("../derived_data/capthists/unm_s_17.csv")[, -1]) 
mrch_s_17 <- addSightings(ch_s_17, unmarked = unm_s_17, uncertain = unid_s_17)
# southern grid 2018 
ch_s_18 <- readRDS("../derived_data/capthists/ch_s_18.RData")
unid_s_18 <- as.matrix(read.csv("../derived_data/capthists/unid_s_18.csv")[, -1]) 
unm_s_18 <- as.matrix(read.csv("../derived_data/capthists/unm_s_18.csv")  [, -1]) 
mrch_s_18 <- addSightings(ch_s_18, unmarked = unm_s_18, uncertain = unid_s_18)
# southern grid 2019 
ch_s_19 <- readRDS("../derived_data/capthists/ch_s_19.RData")
unid_s_19 <- as.matrix(read.csv("../derived_data/capthists/unid_s_19.csv")[, -1]) 
unm_s_19 <- as.matrix(read.csv("../derived_data/capthists/unm_s_19.csv")[, -1]) 
mrch_s_19 <- addSightings(ch_s_19, unmarked = unm_s_19, uncertain = unid_s_19)

# combine capthists per region
mrch_glenelg <- MS.capthist(mrch_a, mrch_c, mrch_h, mrch_mc, ch_lgnpn, ch_lgnps)
mrch_otways <- MS.capthist(mrch_n_17, mrch_s_17, mrch_n_18, mrch_s_18, mrch_n_19, mrch_s_19)
mrch <- MS.capthist(mrch_a, mrch_c, mrch_h, mrch_mc, ch_lgnpn, ch_lgnps, mrch_n_17, mrch_s_17, mrch_n_18, mrch_s_18, mrch_n_19, mrch_s_19)

# load masks
masks <- readRDS("../derived_data/masks.RData")

# load SECR models
df_fits_glenelg <- readRDS("../models/glenelg_df_fits.RData")
glenelg_fits <- readRDS("../models/glenelg_fits.RData")
glenelg_set1 <- readRDS("../models/glenelg_set1.RData")
glenelg_set2 <- readRDS("../models/glenelg_set2.RData")
glenelg_set3 <- readRDS("../models/glenelg_set3.RData")
df_fits_otways <- readRDS("../models/otways_df_fits.RData")
otways_fits <- readRDS("../models/otways_fits.RData")
otways_set1 <- readRDS("../models/otways_set1.RData")
otways_set2 <- readRDS("../models/otways_set2.RData")
otways_set3 <- readRDS("../models/otways_set3.RData")

# load GAMs
gam_g_fox <- readRDS("../models/gam_g_fox.RData")
gam_o_fox <- readRDS("../models/gam_o_fox.RData")

```


\newpage


# Survey methods

## Otway Ranges timeline

```{r, camop,  fig.height = 3, fig.width=4.5, fig.cap = "Camera-trap operation times in the Otway regions, Australia. Each blue horizontal line represents one camera-trap deployment. Grey shading indicates periods of fox control in the impact landscape."}
par(mfrow = c(1,1), mar = c(2.6, 2.1, 2.1, 2.1))
## GLENELG
#camop_glenelg <- cameraOperation(CTtable = records_glenelg, stationCol = "station", setupCol = #"date_start", retrievalCol = "date_end", writecsv = FALSE, hasProblems = FALSE, dateFormat = "%Y-%m-%d")
## plot
#camOp <- camop_glenelg
#which.tmp <- grep(as.Date(colnames(camOp)), pattern = "01$")
#label.tmp <- format(as.Date(colnames(camOp))[which.tmp], "%Y-%m")
#at.tmp <- which.tmp / ncol(camOp)
#values_tmp <- sort(na.omit(unique(c(camOp))))
#image(t(as.matrix(camOp)), xaxt = "n", yaxt = "n", col = "#1b98e0")
#axis(1, at = at.tmp, labels = label.tmp)
## axis(2, at = seq(from = 0, to = 1, length.out = nrow(camOp)), labels = NA, las = 1)
#abline(v = at.tmp, col = rgb(0,0,0, 0.1))
#mtext("a", side = 3, line = 1, at = 0)
## OTWAYS
records_otways <- arrange(records_otways, date_start)
camop_otways    <- cameraOperation(CTtable = records_otways,  stationCol = "station_year", setupCol = "date_start", retrievalCol = "date_end", writecsv = FALSE, hasProblems = FALSE, dateFormat = "%Y-%m-%d")
camOp <- camop_otways
which.tmp <- grep(as.Date(colnames(camOp)), pattern = "01$")
label.tmp <- format(as.Date(colnames(camOp))[which.tmp], "%Y-%m")
at.tmp <- which.tmp / ncol(camOp)
values_tmp <- sort(na.omit(unique(c(camOp))))
image(t(as.matrix(camOp)), xaxt = "n", yaxt = "n", col = "#1b98e0")
axis(1, at = at.tmp, labels = label.tmp)
# axis(2, at = seq(from = 0, to = 1, length.out = nrow(camOp)), labels = NA, las = 1)
abline(v = at.tmp, col = rgb(0,0,0, 0.1))
# plot baiting schedule
polygon(x = c(0.18, 0.458, 0.458, 0.18), y = c(0, 0, 2, 2), col = "grey80")  
polygon(x = c(0.68, 1, 1, 0.68), y = c(0, 0, 2, 2), col = "grey80")  
#replot cams
image(t(as.matrix(camOp)), xaxt = "n", yaxt = "n", col = "#1b98e0", add = TRUE)
abline(v = at.tmp, col = rgb(0,0,0, 0.1))
#mtext("b", side = 3, line = 1, at = 0)
```

\newpage



## Camera-trap deployment
In the Glenelg region, we deployed camera-traps once at a unique sites once. In the Otway region, we redeployed camera-traps in sites three times annually. All 2017 camera-sites were resurveyed each year, except for four logistically challenging sites in the southern grid. In 2018, we added 16 additional sites in the southern grid, as well as 36 additional sites in the northern grid. These additional sites were resurveyed in 2019. 

At each site, we deployed a singular remote trail camera with infrared flash and temperature-in-motion detector. The vast majority of camera-traps were Reconyx Hyperfire HC600, but a small portion was made up of both PC900 and HF2X infrared models (Reconyx, Holmen, Wisconsin). We programmed camera’s to the highest sensitivity and to take five consecutive photographs when triggered (no quiet period). We attached each camera to a tree, approximately 30 cm above the ground, and facing toward a lure 2 - 2.5 metres away. The lure comprised an oil-absorbing cloth doused in tuna oil and placed inside a PVC pipe container with a mesh top. We secured each lure to the top of a 1 metre wooden stake and attached a handful of small white feathers to the outside of the PVC pipe container. Feathers were not used in the Lower Glenelg National Park survey. We cleared vegetation in the camera’s line-of-sight to reduce false triggers and avoid obscuring cat coat markings in images. 

$~$

$~$


```{r cam,  out.width="100%", fig.cap = "Example of a typical camera-trap set-up in the Otway region, Australia."}

knitr::include_graphics("figs/camtrap1.jpg")

```



\newpage


# Individual cat identification

We first labelled every camera-trap image with a species metadata tag using [DigiKam software](https://www.digikam.org){target="_blank"}. We also added metadata tags for each cat coat type: black, mackerel tabby, classic tabby, ginger and other (coats with multiple colour blends; Fig. 3). This allowed us to summarise species records and extract cat images using the 'camtrapR' R-package [@niedballa2016].

We considered all black cats to be of the 'unmarked' category in spatial mark-resight models - even the few with white splotches on their underside (as these couldn't always be seen as cats move with their head down).

In the remaining coat categories where possible, we identified individual cats based on their unique coat markings. The ability to identify individuals substantially increased as the image library for each cat increased. Therefore we made the easiest identifications first to build up these libraries, before making decisions on the less obvious detections. We examined and matched all coat markings seen between two particular defections. Markings on the front legs were the most useful for ID's as the patterns do not skew as much with different body positions. On the whole, unidentifiable detections were mainly due to only part of a cat appearing in the frame, or because photos were blurry (because of cat movement or a foggy camera lens).

We were left with a small number of instances (less than ten) where only left or right flanks could be seen. In this case, the side with the most repeat detections was labelled as an individual, whereas the side with the least number of detections was considered unidentifiable. Additionally, an extremely small portion of cats in the Otways had ginger coats. When ginger coats are photographed with an infrared flash, they become overexposed and no markings can be seen (see the image in bottom-right corner in Fig. S3). We only had one detection of a ginger cat without an infrared coat. Therefore, if there were multiple ginger cat detections in a single grid, we treated them in the same way as one-sided flank detections.

One observer identified the 2018 feral cats in the Glenelg region (MR) and the 2021 Lower Glenelg National Park cats (Luke Woodford). In the 2017 and 2018 Otway datasets (where there were substantially more cat detections and fewer distinct coat patterns) two independent observers identified individual cats and discrepancies between observers were reviewed together until consensus was reached (MR, MLP, BH). If no consensus was reached, the cat was considered unidentifiable. In the 2019 Otway dataset, many of the identified cats were sighted in the previous surveys – these larger individual libraries meant that cats could be identified more easily so only one observer was necessary (MR). We also made use of additional cat images taken within the Otway region grids (just before each of our surveys) by white flash camera-traps from another study (Zoï Banikos, unpublished data). This provided additional and higher quality images (due to the white flash) of individuals in the photo library for identifications.

We were therefore left with three groups of cats: unmarked (black cats), marked (cats which could be identified to the individual-level with complete certainty) and mark status unknown (cats which were not black, but couldn't be identified to the individual level with complete certainty).

We ignored the few detections of cats which were obviously young enough to be dependent on a parent, as these kittens do not have independent activity centres or movements and were not yet recruited into the adult population. 

![Feral cat coat categories from left-right, top-bottom: black, mackerel tabby, classic tabby, other, black, ginger and ginger with infrared flash.](figs/cat_coats.jpg)

\newpage

# Summary statistics 

```{r sstab}
# clean LGNP records for merge
# add grid 
records_lg$st_no <- records_lg$station
records_lg$st_no <- as.integer(gsub('LGNP', "", records_lg$st_no))
records_lg$grid  <- if_else(as.integer(records_lg$station) >= 65, "LGNP_n", "LGNP_s")
# add station_year
records_lg$station_year <- paste0(records_lg$station, "_2021")
## merge LGNP records with other records
records <- bind_rows(records, records_lg)
# add grid variable for gam data
records$grid  <- if_else(grepl("^A", records$station), "Annya", records$grid)
records$grid  <- if_else(grepl("^C", records$station), "Hotspur", records$grid)
records$grid  <- if_else(grepl("^H", records$station), "Cobbob", records$grid)
records$grid  <- if_else(grepl("^M", records$station), "Mt Clay", records$grid)
records$grid  <- if_else(grepl("^T", records$station), "S", records$grid)
records$grid  <- if_else(grepl("^U", records$station), "N", records$grid)
records$grid <- if_else(as.character(records$region) == "otways", paste0(records$grid, "_", records$year), records$grid)
## MAKE TABLE
# transpose summaries as a dataframe and bind together
g <- t(as.data.frame(summary(mrch_glenelg, terse = TRUE, moves = TRUE))) 
o <- t(as.data.frame(summary(mrch_otways, terse = TRUE, moves = TRUE)))
go <- as.data.frame(rbind(g,o))
go <- tibble::rownames_to_column(go, "Grid")
# add region column
go$Region <- c(rep("Glenelg", 6), rep("Otways", 6))
  
# add other detections
go$Unidentified_detections <- c(3,  9,  3,  5, 0, 0,  8, 4, 12, 17, 22, 23)
go$Unmarked_detections     <- c(20, 37, 13, 0, 0, 0, 46, 48, 62, 59, 101, 58)
go$Total_detections <- go$Detections + go$Unidentified_detections + go$Unmarked_detections
# change name of grids
new_grid_names <- c(mrch_a = "Annya", mrch_c ="Cobbob", mrch_h = "Hotspur", mrch_mc = "Mt Clay", ch_lgnpn = "LGNP north", ch_lgnps = "LGNP south", mrch_s_17 = "South 2017", mrch_n_17 = "North 2017", mrch_s_18 = "South 2018", mrch_n_18 = "North 2018", mrch_s_19 = "South 2019", mrch_n_19 = "North 2019")
go$Grid <- as.character(new_grid_names[go$Grid])

# add trapnights
records <- records %>% 
  group_by(grid) %>% 
  mutate(trapnights = sum(survey_duration))
# out of order so do this manually 
# unique(records$trapnights)
go$Trap_nights <- c(8000, 7752, 6085, 5451, 2102, 2842, 3565, 7099, 7838, 4543, 6077, 7150)
# add fox control column
go$Fox_baited <- c("no", "yes", "no", "yes", "no", "yes", "no", "no", "lapsed", "no", "yes", "no")
# get rid of occasions - not informative (as trap nights), total detections
go <- subset(go, select = -c(Occasions, Total_detections, Moves, Region))
# reorder 
go <- go[,c("Grid", "Fox_baited", "Detectors", "Trap_nights", "Animals", "Detections", "Unidentified_detections", "Unmarked_detections")]
# present table
pander(go, split.table = Inf,
       col.names = c("Land- scape", "Fox control?", "Camera- traps", "Trap nights", "Identified cats", "Identified detections", "Unidentified detections", "Unmarked detections"),
       caption = "(\\#tab:sstab) Camera-trap surveys and feral cat spatial capture-recapture summary statistics.")
```

*Note: There is a maximum of one detection per each 24-hour occasion.*



# Feral cat detection plots 

## Glenelg region

### Replicate 1 
```{r, echo = FALSE, fig.cap = "Feral cat detections in the first replicate grid pair in the Glenelg region, Australia. Camera-traps are indicated by red crosses. Solid fill coloured circles represent identified cats with lines indicating observed movements. Black open circles indicate black cat detections; blue circles indicate unidentifiable tabby cat detections, with circle radius scaling positively with the number of daily detections. Fox control does not occur in Annya (a) but does in Cobboboonee (b)."}

par(mfrow = c(1,2), mar = c(2.6, 1, 2.1, 1))

plot(mrch_a, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "a) Annya State Forest", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)
sightingPlot(mrch_a, type = "Tu", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "black")
sightingPlot(mrch_a, type = "Tn", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "blue")

plot(mrch_c, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "b) Cobboboonee National Park", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)
sightingPlot(mrch_c, type = "Tu", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "black")
sightingPlot(mrch_c, type = "Tn", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "blue")

```


\newpage


### Replicate 2
```{r, echo = FALSE, fig.cap = "Feral cat detections in the second replicate grid pair in the Glenelg region, Australia. Camera-traps are indicated by red crosses. Solid fill coloured circles represent identified cats with lines indicating observed movements. Black open circles indicate black cat detections; blue circles indicate unidentifiable tabby cat detections, with circle radius scaling positively with the number of daily detections. Fox control does not occur in Hotspur (a) but does in Mt Clay (b)."}

par(mfrow = c(1,2), mar = c(2.6, 1, 2.1, 1))

plot(mrch_h, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "a) Hotspur State Forest", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)
sightingPlot(mrch_h, type = "Tu", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "black")
sightingPlot(mrch_h, type = "Tn", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "blue")

plot(mrch_mc, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "b) Mt Clay Reserve", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)
sightingPlot(mrch_mc, type = "Tn", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "blue")

```

\newpage


### Replicate 3
```{r, echo = FALSE, fig.cap = "Feral cat detections in the third replicate grid pair in the Glenelg region, Australia. Camera-traps are indicated by red crosses. Solid fill coloured circles represent identified cats with lines indicating observed movements. Black open circles indicate black cat detections; blue circles indicate unidentifiable tabby cat detections, with circle radius scaling positively with the number of daily detections. Fox control does not occur in the north (a) but does in the south (b)."}

par(mfrow = c(1,2), mar = c(2.6, 1, 2.1, 1))

plot(ch_lgnpn, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "a) Lower Glenelg National Park - north", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)

plot(ch_lgnps, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "a) Lower Glenelg National Park - south", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)

```


\newpage


## Otway region
### 2017
```{r, echo = FALSE,   fig.cap = "Feral cat detections in the Otway region, Australia, 2017. Solid fill coloured circles represent identified cats with lines indicating observed movements. Black open circles indicate black cat detections; blue circles indicate unidentifiable tabby cat detections, with circle radius scaling positively with the number of daily detections. Fox control did not occur in either of the landscapes during this time."}

par(mfrow = c(1,2), mar = c(2.6, 1, 2.1, 1))

plot(mrch_n_17, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "a) Otways north 2017", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)
sightingPlot(mrch_n_17, type = "Tu", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "black")
sightingPlot(mrch_n_17, type = "Tn", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "blue")

plot(mrch_s_17, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "b) Otways south 2017", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)
sightingPlot(mrch_s_17, type = "Tu", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "black")
sightingPlot(mrch_s_17, type = "Tn", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "blue")

```


\newpage


### 2018
```{r, echo = FALSE,   fig.cap = "Feral cat detections in the Otway region, Australia, 2018. Solid fill coloured circles represent identified cats with lines indicating observed movements. Black open circles indicate black cat detections; blue circles indicate unidentifiable tabby cat detections, with circle radius scaling positively with the number of daily detections. Fox control had occurred, but lapsed just prior to the survey in the northern landscape (a), and did not occur in the southern landscape (b)."}

par(mfrow = c(1,2), mar = c(2.6, 1, 2.1, 1))

plot(mrch_n_18, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "a) Otways north 2018", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)
sightingPlot(mrch_n_18, type = "Tu", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "black")
sightingPlot(mrch_n_18, type = "Tn", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "blue")

plot(mrch_s_18, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "b) Otways south 2018", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)
sightingPlot(mrch_s_18, type = "Tu", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "black")
sightingPlot(mrch_s_18, type = "Tn", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "blue")

```


\newpage


### 2019
```{r, echo = FALSE, fig.cap = "Feral cat detections in the Otway region, Australia, 2019. Solid fill coloured circles represent identified cats with lines indicating observed movements. Black open circles indicate black cat detections; blue circles indicate unidentifiable tabby cat detections, with circle radius scaling positively with the number of daily detections. Fox control occurred in the northern landscape (a) during this survey, but not the southern landscape (b)."}

par(mfrow = c(1,2), mar = c(2.6, 1, 2.1, 1))

plot(mrch_n_19, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "a) Otways north 2019", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)
sightingPlot(mrch_n_19, type = "Tu", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "black")
sightingPlot(mrch_n_19, type = "Tn", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "blue")

plot(mrch_s_19, rad = 2, tracks = T, bg = "white", detpar = list(col = "black"), title = "b) Otways south 2019", icolours = brewer.pal(12, "Paired"), randcol = TRUE, gridlines = FALSE, cappar = list(cex = 2), border = 10)
sightingPlot(mrch_s_19, type = "Tu", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "black")
sightingPlot(mrch_s_19, type = "Tn", add = TRUE, scale = 200, mean = FALSE, px = 1.1, py = 1.9, title = "", col = "blue")

```


\newpage

# Fox spatial occurrence

## Glenelg region

```{r, echo = FALSE}
summary(gam_g_fox)
```


```{r, echo = FALSE, fig.cap = "Standard error estimate of log fox occurrence probability derived from generalised additive models within each impact (I) and associated non-impact (NI) landscape in the Glenelg region, Australia."}
# LOAD  -------------------------------------------------------------
# lower glenelg shapefiles
LGNPN_traps <- read.table("../raw_data/LGNPN_traps.txt")
LGNPS_traps <- read.table("../raw_data/LGNPS_traps.txt")
LGNP_traps <- rbind(LGNPN_traps, LGNPS_traps)
names(LGNP_traps) <- c("station", "x", "y")
head(LGNP_traps)
# dissolved LGNP buffer zone
LGNPN_dissolved <- st_read(dsn='../raw_data/lower_glenelg_shp/LGNP_dissolved_32754.gpkg') 
# load rivers
rivers <- st_read(dsn='../raw_data/rivers/rivers_buffer_glenelg_32754.gpkg') 
glenelg_river <- filter(rivers, NAME == "GLENELG RIVER")
glenelg_river <- st_union(glenelg_river)
glenelg_river <- st_as_sf(glenelg_river)
# GLENELG FOX PLOT -----------------------------------------------------------
## STEP 1) Make buffer zone around cameras to restrict plotting - optional 
#take just the cams
records_glenelg_cams <- distinct(records_glenelg, station, .keep_all = TRUE)
records_glenelg_cams <- subset(records_glenelg_cams, select = c(station, x, y))
# add lower glenelg cams - for plotting
records_glenelg_cams_lg <- rbind(records_glenelg_cams, LGNP_traps)
records_glenelg_cams_lg_sf <- st_as_sf(records_glenelg_cams_lg, coords = c("x", "y"), crs = 32754) 
# change it to sf class (not lg)
records_glenelg_cams_sf <- st_as_sf(records_glenelg_cams, coords = c("x", "y"), crs = 32754) 
# make a 4km dissolved buffer around each camera
glenelg_cams_buffer <- st_as_sf(st_union(st_buffer(records_glenelg_cams_sf, 4000)))
# add in lower glenelg buffers
glenelg_cams_buffer_union <- st_union(glenelg_cams_buffer, LGNPN_dissolved)
# convert to SpatVector
glenelg_cams_buffer_union_spv <- terra::vect(glenelg_cams_buffer_union)
# extract coordinates to dataframe
glenelg_buffer_df <- as.data.frame(geom(glenelg_cams_buffer_union_spv))
# split by each group (seperate polygon for each grid)
buffer_df1 <- glenelg_buffer_df[which(glenelg_buffer_df$part == "1"),]
buffer_df2 <- glenelg_buffer_df[which(glenelg_buffer_df$part == "2"),]
buffer_df3 <- glenelg_buffer_df[which(glenelg_buffer_df$part == "3"),]
buffer_df4 <- glenelg_buffer_df[which(glenelg_buffer_df$part == "4"),]
buffer_df5 <- glenelg_buffer_df[which(glenelg_buffer_df$part == "5"),]
## STEP 2) MAKE A GRID TO PREDICT DATA INTO
data_glenelg_plot = expand.grid(
  x = seq(min(glenelg_buffer_df$x), 
          max(glenelg_buffer_df$x),
          length=500),
  y = seq(min(glenelg_buffer_df$y),
          max(glenelg_buffer_df$y),
          length=500),
  survey_duration = 60)

# subset to just locations within  of each camera 
data_glenelg_plot1 = data_glenelg_plot[with(data_glenelg_plot, inSide(buffer_df1, x, y)),]
data_glenelg_plot2 = data_glenelg_plot[with(data_glenelg_plot, inSide(buffer_df2, x, y)),]
data_glenelg_plot3 = data_glenelg_plot[with(data_glenelg_plot, inSide(buffer_df3, x, y)),]
data_glenelg_plot4 = data_glenelg_plot[with(data_glenelg_plot, inSide(buffer_df4, x, y)),]
data_glenelg_plot5 = data_glenelg_plot[with(data_glenelg_plot, inSide(buffer_df5, x, y)),]
data_glenelg_plot <- rbind(data_glenelg_plot1, data_glenelg_plot2, data_glenelg_plot3, data_glenelg_plot4, data_glenelg_plot5)
# predict model results into dataframe
data_glenelg_plot <- cbind(data_glenelg_plot, predict.gam(gam_g_fox, newdata = data_glenelg_plot, se.fit = TRUE, type = "link", exclude = c("s(survey_duration)")))
data_glenelg_plot <- rename(data_glenelg_plot, fox_predicted = fit,  fox_predicted_se = se.fit) # rename
# make spatial for plotting
data_glenelg_plot_sf <- st_as_sf(data_glenelg_plot, coords = c("x","y"), crs = 32754)

g_fox_plot <- ggplot() + 
  geom_sf(data = data_glenelg_plot_sf, aes(colour = fox_predicted_se), size = 3) + 
  scale_colour_viridis("Standard error", option = "viridis") + 
  geom_sf(data = glenelg_river, size = 1.2) +
  geom_sf(data = records_glenelg_cams_lg_sf, colour = "white", fill = "white", alpha = 0.3, size = 1, shape = 16) +
  theme_bw(10) + 
  theme(axis.title = element_blank()) + 
  annotate("text", size = 3.5, x = mean(data_glenelg_plot$x) - 8500, y = mean(data_glenelg_plot$y) + 24000, label = "Hotpsur (R2; NI)") + 
  annotate("text", size = 3.5, x = mean(data_glenelg_plot$x) + 23000, y = mean(data_glenelg_plot$y) + 13000, label = "Annya (R1; NI)") + 
  annotate("text", size = 3.5, x = mean(data_glenelg_plot$x) - 14500, y = mean(data_glenelg_plot$y) - 14500, label = "Cobboboonee (R1; I)") + 
  annotate("text", size = 3.5, x = mean(data_glenelg_plot$x) + 9500, y = mean(data_glenelg_plot$y) - 23000, label = "Mt Clay (R2; I)") +
  annotate("text", size = 3.5, x = mean(data_glenelg_plot$x) - 24500, y = mean(data_glenelg_plot$y) + 13000, label = "LGNP north (R3; NI)") + 
  annotate("text", size = 3.5, x = mean(data_glenelg_plot$x) - 33000, y = mean(data_glenelg_plot$y) - 8000, label = "LGNP south (R3; I)")
g_fox_plot
```

\newpage

## Otway Region 

```{r, echo = FALSE}
summary(gam_o_fox)
```

$~$

$~$

$~$

$~$

```{r, echo = FALSE, fig.width = 11, fig.cap = "Standard error estimate of log fox occurrence probability derived from generalised additive models within each impact (I) and associated non-impact (NI) landscape in the Otway region, Australia."}
## STEP 1) Make buffer zone around cameras to restrict plotting - optional 
# change it to sf class
records_otways_cams <- st_as_sf(records_otways, coords = c("x", "y"), crs = 32754) 
# make a 4km buffer around each camera
otways_cams_buffer = st_buffer(records_otways_cams, 4000)
# dissolve the buffer
otways_cams_buffer = st_union(otways_cams_buffer)
# convert back to dataframe
otways_buffer_df <- fortify(as_Spatial(otways_cams_buffer))%>%
  transmute(x = long, y = lat, order = order, group = group)
## STEP 2) MAKE A GRID TO PREDICT DATA INTO
data_otways_plot = expand.grid(
  x = seq(min(otways_buffer_df$x), 
          max(otways_buffer_df$x),
          length=100),
  y = seq(min(otways_buffer_df$y),
          max(otways_buffer_df$y),
          length=100),
  station = "T053", 
  station_year = "T053x2017",
  year = seq(2017,2019,by=1),
  survey_duration = 60)
# subset to just locations within buffer zone
data_otways_plot = data_otways_plot[with(data_otways_plot, inSide(otways_buffer_df, x, y)),]
# predict
data_otways_plot <- cbind(data_otways_plot, predict.gam(gam_o_fox, newdata = data_otways_plot, se.fit = TRUE, type = "link", exclude = c("s(station)", "s(survey_duration)")))
data_otways_plot <- rename(data_otways_plot, fox_predicted = fit,  fox_predicted_se = se.fit) # rename
# make spatial for plotting
data_otways_plot_sf <- st_as_sf(data_otways_plot, coords = c("x","y"), crs = 32754)
## STEP 3) PLOT
# fox plot
o_fox_plot <- ggplot() + 
  geom_sf(data = data_otways_plot_sf, aes(colour = fox_predicted_se), size = 3) + 
  scale_colour_viridis("Standard error", option = "viridis") + 
  facet_wrap(~year, nrow = 1) +
  geom_sf(data = records_otways_cams, colour = "white", fill = "white", alpha = 1, size = 1, shape = 16) +
  theme_bw(10) + 
  theme(axis.title = element_blank()) + 
  annotate("text", x = mean(data_otways_plot$x) + 7500, y = mean(data_otways_plot$y) + 7500, label = "NI") + 
  annotate("text", x = mean(data_otways_plot$x) - 7500, y = mean(data_otways_plot$y) - 7500, label = "I") 
o_fox_plot

```


\newpage

# Vegetation categories

We condensed the main Ecological Vegetation Class groupings [@delwp2020] present into three categories for each region: cleared land, heathy woodlands, lowland forests (Glenelg region only) and wet forests (Otways region only). We merged similar groups to reduce the number of categories for each region. In the Glenelg region, we merged dry forests with lowland forests. In the Otway region, we merged rainforests with wet forests, as well as merged dry forests and heathy woodlands. 

A very small proportion of other Ecological Vegetation Class groupings were present in the habitat masks: riparian scrubs or swampy scrubs and woodlands, coastal scrubs grasslands and woodlands, wetlands, riverine grassy woodlands or forests, plains woodlands or forests, herb-rich woodlands. We removed these groups, and interpolated cell values from the nearest of the three vegetation categories. 

$~$

$~$

```{r, echo = FALSE, fig.cap="Condensed Ecological Vegetation Class groups used as habitat mask covariates in spatial mark-resight models."}
# plot Vegetation class - glenelg
forestcol <- terrain.colors(6, rev = TRUE)[c(1,5,3)]
names(masks) <- c("Annya", "Cobboboonee", "Hotspur", "Mt Clay", "LGNP north", "LGNP south", "Otways: North", "Otways: South", "Otways: North '18", "Otways: South '18", "Otways: North '19", "Otways: South '19")
par (mfrow = c(2, 5), mar = c(0,0,5,0))
for (sess in 1:6) {
  plot(masks[[sess]], covariate = 'vegetation', legend = FALSE, dots = FALSE, border = 100, col = forestcol) 
  plotMaskEdge((mrch)[[sess]], add = TRUE, plt = TRUE)
  plot(traps(mrch)[[sess]], add = TRUE, detpar = list(pch = 16, cex = 0.25, col = "black"))
  mtext(side=3, paste(session(masks)[[sess]])) }
# plot Vegetation class - otways
forestcol <- terrain.colors(6, rev = TRUE)[c(1,3,6)]
for (sess in 7:8) {
  plot(masks[[sess]], covariate = 'vegetation', legend = FALSE, dots = FALSE, border = 100, col = forestcol) 
  plotMaskEdge((mrch)[[sess]], add = TRUE, plt = TRUE)
  plot(traps(mrch)[[sess]], add = TRUE, detpar = list(pch = 16, cex = 0.25, col = "black"))
  mtext(side=3, paste(session(masks)[[sess]])) }
# null plots for seperate legend
plot(NULL ,xaxt='n',yaxt='n',bty='n',ylab='',xlab='', xlim=0:1, ylim=0:1)
plot(NULL ,xaxt='n',yaxt='n',bty='n',ylab='',xlab='', xlim=0:1, ylim=0:1)
# legend
legend (x = "left", fill = terrain.colors(6, rev = TRUE)[c(1,5,3,6)], legend = c("Cleared", "Dry Forest", "Heathy", "Wet Forest"), bty='n', title = "Vegetation type", pt.cex=3, cex=1.2)

```




# Spatial mark-resight models 

## Glenelg region 

### Detector function fits

```{r, fig.cap = "Detector function shapes (solid line) and 95% confidence intervals (dashed lines) tested for the Glenelg region, Australia."}
plot(df_fits_glenelg$fit1_ex, add = FALSE, col = c(rgb(0.2,0.4,0.1,0.7)), lwd = 2, 
     sigmatick = FALSE, rgr = FALSE, limits = TRUE, alpha = 0.05,
     xval = 0:2000, ylim = NULL, xlab = "Distance from activity centre (m)", ylab = NULL)
plot(df_fits_glenelg$fit1_hn, add = TRUE, col = c(rgb(0.8,0.4,0.1,0.7)), lwd = 2,
     sigmatick = FALSE, rgr = FALSE, limits = TRUE, alpha = 0.05,
     xval = 0:2000, ylim = NULL, xlab = NULL, ylab = NULL)
legend("topright", 
       legend = c("Half-normal", "Exponential"), 
       col = c(rgb(0.2,0.4,0.1,0.7), 
               rgb(0.8,0.4,0.1,0.7)), 
       lwd = 2, 
       bty = "n", 
       pt.cex = 2, 
       cex = 1, 
       text.col = "black", 
       horiz = FALSE, 
       inset = c(0.1, 0.1))
```

$~$

```{r df_aic_g}
df_fits_glenelg_aic <- AIC(df_fits_glenelg, criterion = "AICc")[,-2]
df_fits_glenelg_aic <- subset(df_fits_glenelg_aic, select = -c(model))
df_fits_glenelg_aic$logLik <- round(df_fits_glenelg_aic$logLik, digits = 2)
df_fits_glenelg_aic$AIC    <- round(df_fits_glenelg_aic$AIC, digits = 2)
df_fits_glenelg_aic$AICc   <- round(df_fits_glenelg_aic$AICc, digits = 2)
df_fits_glenelg_aic$dAICc   <- round(df_fits_glenelg_aic$dAICc, digits = 2)
df_fits_glenelg_aic$AICcwt  <- round(df_fits_glenelg_aic$AICcwt, digits = 2)
df_fits_glenelg_aic <- tibble::rownames_to_column(df_fits_glenelg_aic, "fit")
df_fits_glenelg_aic$fit <- ifelse(df_fits_glenelg_aic$fit == "fit1_ex", "exponential", "half-normal")
pander(df_fits_glenelg_aic, split.cell = 40, split.table = Inf, col.names = c("Detector function", "Parameters", "logLik", "AIC", "AICc", "dAICc", "AICcwt"), round = 3,
       caption = "Akaike's Information Criterion values for detector functions in the Glenelg region, Australia; model set 1.")

```

\newpage

### Candidate model fits

```{r aic_g}

## set 1
glenelg_set1_tab <- AIC(glenelg_set1, criterion = "AICc")[,-2]
rownames(glenelg_set1_tab) <- NULL
pander(glenelg_set1_tab, 
       split.cell = 40, 
       split.table = Inf, 
       digits = 6,
    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Glenelg region; model set 2.")


## set 2
glenelg_set2_tab <- AIC(glenelg_set2, criterion = "AICc")[,-2]
rownames(glenelg_set2_tab) <- NULL
glenelg_set2_tab$model <- gsub("predicted_trapcov", "occ", glenelg_set2_tab$model)
glenelg_set2_tab$model <- gsub("fox_predicted", "fox_occ", glenelg_set2_tab$model)

pander(glenelg_set2_tab, 
       split.cell = 40, 
       split.table = Inf, 
       digits = 6,
    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Glenelg region; model set 3.")


## set 3
glenelg_set3_tab <- AIC(glenelg_set3, criterion = "AICc")[,-2]
rownames(glenelg_set3_tab) <- NULL
glenelg_set3_tab$model <- gsub("predicted_trapcov", "occ", glenelg_set3_tab$model)
glenelg_set3_tab$model <- gsub("fox_predicted", "fox_occ", glenelg_set3_tab$model)
pander(glenelg_set3_tab, 
       split.cell = 40, 
       split.table = Inf, 
       digits = 6,
    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Glenelg region; model set 4.")


#aic_tab <- AIC(glenelg_fits, criterion = "AICc")[,-2]
## remove sigma (change to detectability)
#aic_tab$model  <-gsub("sigma.*","", aic_tab$model)
## fix up names spaces etc
#aic_tab$model <- gsub("_trapcov", "", aic_tab$model)
#
#aic_tab$model <- gsub(" g0", ", g0", aic_tab$model)
#aic_tab$model <- gsub(" sigma", ", sigma", aic_tab$model)
#aic_tab$model <- gsub("~", " ~ ", aic_tab$model)
#aic_tab$model <- gsub("predicted", "occ", aic_tab$model)
## split detectability and density into seperate columns
#library(stringr)
#aic_tab$density <- str_split_fixed(aic_tab$model, ", g0", 2)[,1]
#aic_tab$detectability <- str_split_fixed(aic_tab$model, " g0", 2)[,2]
#aic_tab$density <- gsub("D ~ ", "", aic_tab$density)
#aic_tab$detectability <- gsub("~ ", "", aic_tab$detectability)
## final clean
#aic_tab <- tibble::rownames_to_column(aic_tab, "fit")
#aic_tab <- subset(aic_tab, select = -c(AIC, AICcwt, fit, model))
#aic_tab <- relocate(aic_tab, density, detectability)
#
## split to model sets
#aic_tab1 <- filter(aic_tab, grepl("T", aic_tab$detectability) | grepl("vegetation", aic_tab$density) | (grepl("1", #aic_tab$detectability) & grepl("1", aic_tab$density)))
#aic_tab2 <- filter(aic_tab, grepl("fox_occ", aic_tab$density) | grepl("fox_occ", aic_tab$detectability) | (grepl("1", #aic_tab$detectability) & grepl("1", aic_tab$density)))
#aic_tab3 <- filter(aic_tab, grepl("session", aic_tab$density))
#
## recalculate dAICc for each set
#aic_tab1 <- aic_tab1 %>% arrange(AICc) %>% mutate(dAICc = AICc - min(AICc)) 
#aic_tab2 <- aic_tab2 %>% arrange(AICc) %>% mutate(dAICc = AICc - min(AICc)) 
#aic_tab3 <- aic_tab3 %>% arrange(AICc) %>% mutate(dAICc = AICc - min(AICc)) 
#
## make tables
#pander(aic_tab1, 
#       split.cell = 40, 
#       split.table = Inf, 
#       digits = 6,
#       col.names = c("Density", "Detectability", "Parameters", "logLik", "AICc", "dAICc"),  
#    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Glenelg #region; model set 1 (ordered in decreasing AICc scores).")
#
#pander(aic_tab2, 
#       split.cell = 40, 
#       split.table = Inf, 
#       digits = 6,
#       col.names = c("Density", "Detectability", "Parameters", "logLik", "AICc"," dAICc"),  
#    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Glenelg #region; model set 2 (ordered in decreasing AICc scores).")
#
#pander(aic_tab3, 
#       split.cell = 40, 
#       split.table = Inf, 
#       digits = 6,
#       col.names = c("Density", "Detectability", "Parameters", "logLik", "AICc", "dAICc"),  
#    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Glenelg #region; model set 3 (ordered in decreasing AICc scores).")

```



***1*** - *constant*

***T*** - *linear time trend (g0 only)*

***vegetation*** - *modified EVC group: dry forest, heathy vegetation or cleared*

***fox_occ*** - *fine-scale occurrence probability of foxes derived from generalised additive models*

***s(fox_occ, k = 3)*** - *non-linear smooth of fox_occ with three knots*

***session*** - *landscape (n = 4)*

\newpage


```{r , echo = FALSE}

estimate <- as.data.frame(unlist(sapply(predict(glenelg_fits$fit_sess2), "[", "D","estimate")))
names(estimate)[1] <- "estimate"
estimate <- tibble::rownames_to_column(estimate, "grid")
lower_bound <- as.data.frame(unlist(sapply(predict(glenelg_fits$fit_sess2), "[", "D","lcl")))
names(lower_bound)[1] <- "lcl"
lower_bound <- tibble::rownames_to_column(lower_bound, "grid")
upper_bound <- as.data.frame(unlist(sapply(predict(glenelg_fits$fit_sess2), "[", "D","ucl")))
names(upper_bound)[1] <- "ucl"
upper_bound <- tibble::rownames_to_column(upper_bound, "grid")
temp <- merge(lower_bound, upper_bound, by = "grid")
x <- merge(estimate, temp, by = "grid")
# rename grid
x$grid <- c("LGNP north", "LGNP south", "Annya","Cobboboonee", "Hotspur", "Mt Clay")
# add treatment variable
x$Treatment <- c("Non-impact", "Impact", "Non-impact", "Impact", "Non-impact", "Impact")
# add pair variable
x$Replicate <- c("Replicate 3", "Replicate 3", "Replicate 1", "Replicate 1", "Replicate 2", "Replicate 2")
# covert from hectares to km2
x$estimate <- x$estimate*100
x$lcl <- x$lcl*100
x$ucl <- x$ucl*100
x <- arrange(x, Replicate)

pander(x, 
       split.cell = 40, 
       split.table = Inf, 
       digits = 2,
       col.names = c("Landscape", "Estimate", "5% CI", "95% CI", "Treatment", "Pair"),  
    caption = "Feral cat density estimates per square kilometre in the Glenelg region landscapes, Australia.")

```


\newpage


## Otway region 

### Detector function fits

```{r, fig.cap = "Detector function shapes (solid line) and 95% confidence intervals (dashed lines) tested for the Otway region, Australia."}
plot(df_fits_otways$fit1_ex, add = FALSE, col = c(rgb(0.2,0.4,0.1,0.7)), lwd = 2, 
     sigmatick = FALSE, rgr = FALSE, limits = TRUE, alpha = 0.05,
     xval = 0:2000, ylim = NULL, xlab = "Distance from activity centre (m)", ylab = NULL)
plot(df_fits_otways$fit1_hn, add = TRUE, col = c(rgb(0.8,0.4,0.1,0.7)), lwd = 2,
     sigmatick = FALSE, rgr = FALSE, limits = TRUE, alpha = 0.05,
     xval = 0:2000, ylim = NULL, xlab = NULL, ylab = NULL)
legend("topright", 
       legend = c("Half-normal", "Exponential"), 
       col = c(rgb(0.2,0.4,0.1,0.7), 
               rgb(0.8,0.4,0.1,0.7)), 
       lwd = 2, 
       bty = "n", 
       pt.cex = 2, 
       cex = 1, 
       text.col = "black", 
       horiz = FALSE, 
       inset = c(0.1, 0.1))
```

$~$

```{r df_aic_o}
df_fits_otways_aic <- AIC(df_fits_otways, criterion = "AICc")[,-2]
df_fits_otways_aic <- subset(df_fits_otways_aic, select = -c(model))
df_fits_otways_aic$logLik <- round(df_fits_otways_aic$logLik, digits = 2)
df_fits_otways_aic$AIC    <- round(df_fits_otways_aic$AIC, digits = 2)
df_fits_otways_aic$AICc   <- round(df_fits_otways_aic$AICc, digits = 2)
df_fits_otways_aic$dAICc   <- round(df_fits_otways_aic$dAICc, digits = 2)
df_fits_otways_aic$AICcwt  <- round(df_fits_otways_aic$AICcwt, digits = 2)
df_fits_otways_aic <- tibble::rownames_to_column(df_fits_otways_aic, "fit")
df_fits_otways_aic$fit <- ifelse(df_fits_otways_aic$fit == "fit1_ex", "exponential", "half-normal")
pander(df_fits_otways_aic, split.cell = 40, split.table = Inf, col.names = c("Detector function", "Parameters", "logLik", "AIC", "AICc", "dAICc", "AICcwt"), round = 3,
       caption = "Akaike's Information Criterion values for detector functions in the Otway region, Australia; model set 1.")
```

\newpage

### Candidate model fits

```{r aic_o}

## set 1
otways_set1_tab <- AIC(otways_set1, criterion = "AICc")[,-2]
rownames(otways_set1_tab) <- NULL
pander(otways_set1_tab, 
       split.cell = 40, 
       split.table = Inf, 
       digits = 6,
    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Otway region; model set 2.")


## set 2
otways_set2_tab <- AIC(otways_set2, criterion = "AICc")[,-2]
rownames(otways_set2_tab) <- NULL
otways_set2_tab$model <- gsub("predicted_trapcov", "occ", otways_set2_tab$model)
otways_set2_tab$model <- gsub("fox_predicted", "fox_occ", otways_set2_tab$model)
pander(otways_set2_tab, 
       split.cell = 40, 
       split.table = Inf, 
       digits = 6,
    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Otway region; model set 3.")


## set 3
otways_set3_tab <- AIC(otways_set3, criterion = "AICc")[,-2]
rownames(otways_set3_tab) <- NULL
otways_set3_tab$model <- gsub("predicted_trapcov", "occ", otways_set3_tab$model)
otways_set3_tab$model <- gsub("fox_predicted", "fox_occ", otways_set3_tab$model)
pander(otways_set3_tab, 
       split.cell = 40, 
       split.table = Inf, 
       digits = 6,
    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Otway region; model set 4.")


#aic_tab <- AIC(otways_fits, criterion = "AICc")[,-2]
## remove sigma (will change to just detectability)
#aic_tab$model  <- gsub("sigma.*","", aic_tab$model )
## fix up names spaces etc
#aic_tab$model <- gsub("_trapcov", "", aic_tab$model)
#aic_tab$model <- gsub(" g0", ", g0", aic_tab$model)
#aic_tab$model <- gsub(" sigma", ", sigma", aic_tab$model)
#aic_tab$model <- gsub("~", " ~ ", aic_tab$model)
#aic_tab$model <- gsub("predicted", "occ", aic_tab$model)
#aic_tab$model <- gsub("foxbaiting", "foxbaited_01", aic_tab$model)
## split detectability and density into separate columns
#library(stringr)
#aic_tab$density <- str_split_fixed(aic_tab$model, ", g0", 2)[,1]
#aic_tab$detectability <- str_split_fixed(aic_tab$model, " g0", 2)[,2]
#aic_tab$density <- gsub("D ~ ", "", aic_tab$density)
#aic_tab$detectability <- gsub("~ ", "", aic_tab$detectability)
#aic_tab$detectability <- gsub("baiting2", "foxbaiting_012", aic_tab$detectability)
## final clean
#aic_tab <- tibble::rownames_to_column(aic_tab, "fit")
#aic_tab <- subset(aic_tab, select = -c(AIC, AICcwt, fit, model))
#aic_tab <- relocate(aic_tab, density, detectability)
#
## split to model sets
#aic_tab1 <- filter(aic_tab, grepl("T", aic_tab$detectability) | grepl("vegetation", aic_tab$density) | (grepl("1", #aic_tab$detectability) & grepl("^year$", aic_tab$density)))
#aic_tab2 <- filter(aic_tab, grepl("fox_occ", aic_tab$density) | grepl("fox_occ", aic_tab$detectability) | (grepl("1", #aic_tab$detectability) & grepl("^year$", aic_tab$density)))
#aic_tab3 <- filter(aic_tab, grepl("session", aic_tab$density))
#
## recalculate dAICc for each set
#aic_tab1 <- aic_tab1 %>% arrange(AICc) %>% mutate(dAICc = AICc - min(AICc))
#aic_tab2 <- aic_tab2 %>% arrange(AICc) %>% mutate(dAICc = AICc - min(AICc))
#aic_tab3 <- aic_tab3 %>% arrange(AICc) %>% mutate(dAICc = AICc - min(AICc))
#
## make tables
#pander(aic_tab1, 
#       split.cell = 40, 
#       split.table = Inf, 
#       digits = 6,
#       col.names = c("Density", "Detectability", "Parameters", "logLik", "AICc", "dAICc"),  
#    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Otway region, #Australia; model set 1 (ordered in decreasing AICc scores).")
#
#pander(aic_tab2, 
#       split.cell = 40, 
#       split.table = Inf, 
#       digits = 6,
#       col.names = c("Density", "Detectability", "Parameters", "logLik", "AICc"," dAICc"),  
#    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Otway region, #Australia; model set 2 (ordered in decreasing AICc scores).")
#
#pander(aic_tab3, 
#       split.cell = 40, 
#       split.table = Inf, 
#       digits = 6,
#       col.names = c("Density", "Detectability", "Parameters", "logLik", "AICc", "dAICc"),  
#    caption = "Akaike's Information Criterion values adjusted for small sample size for feral cat density models in the Otway region, #Australia; model set 3 (ordered in decreasing AICc scores).")
```

***1*** - *constant*

***T*** - *linear time trend (g0 only)*

***vegetation*** - *modified EVC group: wet forest, heathy vegetation or cleared*

***year*** - *year of deployment (2017-19)*

***fox_occ*** - *fine-scale occurrence probability of foxes derived from generalised additive models*

***s(fox_occ, k = 3)*** - *non-linear smooth of fox_occ with three knots*

***session*** - *landscape (n = 4)*





\newpage



```{r , echo = FALSE}

## Extract estimates
estimate <- as.data.frame(unlist(sapply(predict(otways_fits$fit_sess2), "[", "D","estimate")))
names(estimate)[1] <- "estimate"
estimate <- tibble::rownames_to_column(estimate, "grid")
lower_bound <- as.data.frame(unlist(sapply(predict(otways_fits$fit_sess2), "[", "D","lcl")))
names(lower_bound)[1] <- "lcl"
lower_bound <- tibble::rownames_to_column(lower_bound, "grid")
upper_bound <- as.data.frame(unlist(sapply(predict(otways_fits$fit_sess2), "[", "D","ucl")))
names(upper_bound)[1] <- "ucl"
upper_bound <- tibble::rownames_to_column(upper_bound, "grid")
temp <- merge(lower_bound, upper_bound, by = "grid")
fit_baci_vals <- merge(estimate, temp, by = "grid")
# rename grid
fit_baci_vals$grid <- gsub("session = ", "", fit_baci_vals$grid)
fit_baci_vals$grid <- substr(fit_baci_vals$grid, 0, 9)
new_grid_names <- c(mrch_n_17 = "north 2017", mrch_n_18 = "north 2018", mrch_n_19 = "north 2019", mrch_s_17 = "south 2017", mrch_s_18 = "south 2018", mrch_s_19 = "south 2019")
fit_baci_vals$grid <- as.character(new_grid_names[fit_baci_vals$grid])
# add treatment variable
fit_baci_vals$landscape <- c("Non-impact", "Non-impact", "Non-impact", "Impact", "Impact", "Impact")
fit_baci_vals$year <- c("2017", "2018", "2019", "2017", "2018", "2019")
# covert from hectares to km2
fit_baci_vals$estimate <- fit_baci_vals$estimate*100
fit_baci_vals$lcl <- fit_baci_vals$lcl*100
fit_baci_vals$ucl <- fit_baci_vals$ucl*100
fit_baci_vals <- arrange(fit_baci_vals, year)

pander(fit_baci_vals, 
       split.cell = 40, 
       split.table = Inf, 
       digits = 2,
       col.names = c("Landscape", "Estimate", "5% CI", "95% CI", "Treatment", "Pair"),  
    caption = "Feral cat density estimates per square kilometre in the Otway region landscapes, Australia.")

```


\newpage


# Session information

```{r}

sessionInfo() %>% pander()

```



# References {#references .unnumbered}
